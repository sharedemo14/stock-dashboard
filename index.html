<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Stock Dashboard</title>

<style>
body { font-family: Arial; padding: 15px; }
input, button { padding: 8px; margin: 5px 0; width: 100%; }
table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
th { background: #f2f2f2; }
.green { color: green; }
.red { color: red; }
.card { border:1px solid #ccc; padding:10px; border-radius:8px; }
</style>
</head>

<body>

<h2>üìä Stock Dashboard</h2>

<div class="card">
  <input id="date" type="date">
  <input id="ticker" placeholder="Ticker (HDFCBANK)">
  <input id="owner" placeholder="Owner (Self / Wife / Son)">
  <input id="rate" type="number" placeholder="Buy Rate">
  <input id="qty" type="number" placeholder="Qty">
  <button onclick="addTrade()">‚ûï Add Stock</button>
</div>

<input id="search" placeholder="Search ticker" onkeyup="render()">

<h3>
Total Invested ‚Çπ<span id="totalInv">0</span> |
P/L ‚Çπ<span id="totalPL">0</span>
</h3>

<table>
<thead>
<tr>
<th>Date</th><th>Ticker</th><th>Owner</th>
<th>Rate</th><th>Qty</th><th>Invested</th>
<th>CMP</th><th>P/L</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>

<h3>üë®‚Äçüë©‚Äçüëß Owner-wise Summary</h3>
<table>
<thead>
<tr><th>Owner</th><th>Invested</th><th>P/L</th></tr>
</thead>
<tbody id="ownerSummary"></tbody>
</table>

<script>
/* ===== CONFIG ===== */
const WEB_APP_URL = "https://sharedemo14.github.io/stock-dashboard/";

/* ===== ADD TRADE ===== */
function addTrade() {
  const data = {
    date: date.value,
    ticker: ticker.value.toUpperCase(),
    owner: owner.value,
    rate: Number(rate.value),
    qty: Number(qty.value)
  };

  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify(data)
  }).then(() => {
    clearInputs();
    loadData();
  });
}

/* ===== LOAD DATA ===== */
function loadData() {
  fetch(WEB_APP_URL)
    .then(res => res.json())
    .then(rows => {
      window.rows = rows;
      render();
    });
}

/* ===== RENDER ===== */
function render() {
  let q = search.value.toUpperCase();
  table.innerHTML = "";
  ownerSummary.innerHTML = "";

  let totalInv = 0, totalPL = 0;
  let owners = {};

  rows.filter(r => r[1].includes(q)).forEach(r => {
    let invested = r[3] * r[4];
    let pl = r[7];

    totalInv += invested;
    totalPL += pl;

    if (!owners[r[2]]) owners[r[2]] = { inv:0, pl:0 };
    owners[r[2]].inv += invested;
    owners[r[2]].pl += pl;

    table.innerHTML += `
      <tr>
        <td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td>
        <td>${r[3]}</td><td>${r[4]}</td>
        <td>${invested}</td><td>${r[6]}</td>
        <td class="${pl>=0?'green':'red'}">${pl}</td>
      </tr>`;
  });

  totalInvSpan = document.getElementById("totalInv");
  totalPLSpan = document.getElementById("totalPL");
  totalInvSpan.innerText = totalInv;
  totalPLSpan.innerText = totalPL;

  for (let o in owners) {
    ownerSummary.innerHTML += `
      <tr>
        <td>${o}</td>
        <td>${owners[o].inv}</td>
        <td class="${owners[o].pl>=0?'green':'red'}">${owners[o].pl}</td>
      </tr>`;
  }
}

/* ===== HELPERS ===== */
function clearInputs() {
  date.value = ticker.value = owner.value = rate.value = qty.value = "";
}

loadData();
</script>

</body>
</html>
